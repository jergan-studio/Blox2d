<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blox2D Client (Multiplayer)</title>
<style>
body{margin:0;font-family:Arial;background:#000;color:white;display:flex;flex-direction:column;align-items:center;}
header{padding:15px;background:#121217;width:100%;text-align:center;font-weight:bold;}
#canvas{background:#111;margin-top:10px;border:1px solid #333;}
#scoreMsg{color:#4da6ff;margin-top:10px;}
</style>
</head>
<body>

<header>ðŸŽ® Blox2D Client (Multiplayer)</header>
<canvas id="canvas" width="800" height="500"></canvas>
<div id="scoreMsg"></div>

<script>
// Get game ID from URL
const params = new URLSearchParams(window.location.search);
const id = params.get("id");
const games = JSON.parse(localStorage.getItem("blox_games")||"[]");
const game = games.find(g=>g.id===id);
if(!game){ alert("Game not found!"); throw new Error("Game not found"); }

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const scoreMsg = document.getElementById("scoreMsg");

let player={x:100,y:400,w:30,h:30,color:"#4da6ff",speed:5,jumpHeight:12,velY:0,onGround:false};
let gravity=1,score=0,messages=[],keys={};
let objects = game.objects.map(o=>({...o}));

// Parse script
const lines = game.script.split("\n").map(l=>l.trim());
let inStart=false;
lines.forEach(line=>{
  if(line.startsWith("//")||line==="") return;
  if(line.startsWith("when start")){inStart=true;return;}
  if(line==="end"){inStart=false;return;}
  if(inStart){
    if(line.startsWith("player.speed")) player.speed=parseInt(line.split("=")[1]);
    if(line.startsWith("player.jumpHeight")) player.jumpHeight=parseInt(line.split("=")[1]);
    if(line.startsWith("player.color")) player.color=line.split('"')[1];
    if(line.startsWith("gravity")) gravity=parseFloat(line.split("=")[1]);
    if(line.startsWith("score")) score=parseInt(line.split("=")[1]);
  }
});

// Key events
window.addEventListener("keydown",e=>keys[e.key]=true);
window.addEventListener("keyup",e=>keys[e.key]=false);

// Multiplayer setup
const ws = new WebSocket("ws://localhost:8080");
let playerID = null;
let otherPlayers = {};

ws.onopen = ()=>{
  ws.send(JSON.stringify({type:'join', gameID:id, x:player.x, y:player.y}));
};

ws.onmessage = e=>{
  const data = JSON.parse(e.data);
  if(data.type==='joined') playerID=data.playerID;
  if(data.type==='player
